define(function(require,exports,module){require("jquery");(function(window,document,undefined){var ready={index:0,timer:{},end:{}};var popupBox={open:function(options){var o=new PopupBox(options);return o.boxIndex},msg:function(content,options){var defaultConfig={type:1,className:"customLayer-msg",shadeClassName:"customLayer-msgShade",shade:false,shadeClose:false,closeBtn:false,title:false,content:'<div class="png"></div><div class="pngCon">'+content+"</div>",btn:[],time:3000},msgConfig=options||{};$.extend(defaultConfig,msgConfig);var o=new PopupBox(defaultConfig);return o.boxIndex},load:function(options){var defaultConfig={type:1,className:"customLayer-load",shadeClassName:"customLayer-loadShade",shade:true,shadeClose:false,closeBtn:false,title:false,content:'<div class="loading"></div>',btn:[],time:3000},loadConfig=options||{};$.extend(defaultConfig,loadConfig);var o=new PopupBox(defaultConfig);return o.boxIndex},close:function(index){var elem=$("#customLayer"+index),contentDom=elem.find(".customLayer-content").children(),shadeDom=$("#customLayer-shade"+index);clearTimeout(ready.timer[index]);delete ready.timer[index];shadeDom.remove();if(elem.attr("contype")=="Object"){elem.find(".customLayer-setwin").remove();elem.find(".customLayer-title").remove();elem.find(".customLayer-btn").remove();contentDom.parents(".customLayer-content").unwrap();contentDom.unwrap().css("display","none")}else{elem.remove()}typeof ready.end[index]==="function"&&ready.end[index]();delete ready.end[index]},closeAll:function(){var _this=this;$(".customLayer").each(function(){var Index=Number($(this).attr("id").replace("customLayer",""));_this.close(Index)})}};var PopupBox=function(options){var that=this;that.config={type:0,className:"",shadeClassName:"",shade:true,shadeClose:true,closeBtn:true,fixed:true,area:["auto","auto"],maxWidth:360,title:"信息",content:"",btn:[],time:0};$.extend(that.config,options);that.view()};PopupBox.prototype.view=function(){var that=this,config=that.config,noTitle=config.title?"":"customLayer-noTitle",windowW=$(window).width(),windowH=$(window).height(),initialZindex=998,contype=config.content instanceof Object?"Object":"String";that.boxIndex=++ready.index;var titleStr='<div class="customLayer-title">'+config.title+"</div>",shadeStr='<div class="customLayer-shade '+config.shadeClassName+'" id="customLayer-shade'+that.boxIndex+'" style="z-index: '+(initialZindex+that.boxIndex-1)+';"></div>',closeBtnStr='<div class="customLayer-setwin">'+'<a href="javascript:void(0);" class="customLayer-close"></a>'+"</div>",btnStr="";if(config.btn.length>0){btnStr+='<div class="customLayer-btn">';for(var i=0;i<(config.btn.length>2?2:config.btn.length);i++){btnStr+='<a href="javascript:void(0);" class="customLayer-btn'+i+'">'+config.btn[i]+"</a>"}btnStr+="</div>"}if(contype=="Object"){config.content.css("display","block").wrap('<div class="customLayer '+config.className+" "+noTitle+'" id="customLayer'+that.boxIndex+'" contype="'+contype+'" style="z-index: '+(initialZindex+that.boxIndex)+';"><div class="customLayer-content"></div></div>');if(config.title){config.content.parents(".customLayer").prepend(titleStr)}if(config.closeBtn){config.content.parents(".customLayer").prepend(closeBtnStr)}if(config.btn.length>0){config.content.parents(".customLayer").append(btnStr)}}else{var domStr='<div class="customLayer '+config.className+" "+noTitle+'" id="customLayer'+that.boxIndex+'" contype="'+contype+'" style="z-index: '+(initialZindex+that.boxIndex)+'">';if(config.title){domStr+=titleStr}if(config.closeBtn){domStr+=closeBtnStr}domStr+='<div class="customLayer-content">';domStr+=config.content;domStr+="</div>";if(config.btn.length>0){domStr+=btnStr}domStr+="</div>";$("body").append(domStr)}if(config.shade){$("body").append(shadeStr)}var elem=$("#customLayer"+that.boxIndex);if(!config.fixed){elem.css("position","absolute")}config.area[0]=(function(){var a;if(config.area[0]=="auto"){a=(elem.width()>config.maxWidth)?config.maxWidth:elem.width()}else{a=config.area[0]}return a})();elem.width(config.area[0]);config.area[1]=(function(){var a;if(config.area[1]=="auto"){a=(elem.height()>config.maxHeight)?config.maxHeight:elem.height()}else{a=config.area[1]}return a})();elem.height(config.area[1]);var boxX=(windowW-config.area[0])/2,boxY=(function(){if(windowH>config.area[1]){return(windowH-config.area[1])/2+(config.fixed?0:$(document).scrollTop())}else{return config.fixed?0:$(document).scrollTop()}})(),titleH=elem.find(".customLayer-title").outerHeight()==null?0:elem.find(".customLayer-title").outerHeight(),btnH=elem.find(".customLayer-btn").outerHeight()==null?0:elem.find(".customLayer-btn").outerHeight();elem.addClass("customLayer-anim-scale").css({"top":boxY+"px","left":boxX+"px"});if(config.type==0){elem.find(".customLayer-content").css({"height":(config.area[1]-titleH-btnH)+"px"})}setTimeout(function(){elem.removeClass("customLayer-anim-scale")},300);if(typeof config.success==="function"){config.success(that.boxIndex,elem)}that.action(config,elem)};PopupBox.prototype.action=function(config,elem){var that=this,closeBtnDom=elem.find("a.customLayer-close"),shadeDom=$("#customLayer-shade"+that.boxIndex),confirmBtnDom=elem.find(".customLayer-btn0"),cancelBtnDom=elem.find(".customLayer-btn1");config.end&&(ready.end[that.boxIndex]=config.end);if(config.shadeClose){shadeDom.off("click").on("click",function(){popupBox.close(that.boxIndex)})}if(config.closeBtn){closeBtnDom.on("click",function(){var isClose=config.cancel&&config.cancel(that.boxIndex,elem);if(isClose==undefined){popupBox.close(that.boxIndex)}})}if(config.time){ready.timer[that.boxIndex]=setTimeout(function(){popupBox.close(that.boxIndex)},config.time)}if(config.btn.length>0){confirmBtnDom.on("click",function(){var isClose=config.yes&&config.yes(that.boxIndex,elem);if(isClose==undefined){popupBox.close(that.boxIndex)}});cancelBtnDom.on("click",function(){popupBox.close(that.boxIndex)})}};window.popupBox=popupBox;module.exports=popupBox})(window,document)});